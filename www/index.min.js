$(function(){Date.prototype.toYMD=function(){let t,e,a;t=String(this.getFullYear()),1===(e=String(this.getMonth()+1)).length&&(e="0"+e);1===(a=String(this.getDate())).length&&(a="0"+a);return t+"-"+e+"-"+a};let t=(new Date).toUTCString();$("#title").html("COVID-19 Statistics as of "+t),window.setInterval(function(){t=(new Date).toUTCString(),$("#title").html("COVID-19 Statistics as of "+t)},1e3);const e=document.getElementById("worldwide-chart").getContext("2d"),a=document.getElementById("outlook-chart").getContext("2d"),o=new Chart(e,{type:"line",data:l(null),options:{responsive:!0,maintainAspectRatio:!1,scales:{xAxes:[{gridLines:{display:!1},ticks:{autoSkip:!0,maxTicksLimit:20}}],yAxes:[{ticks:{beginAtZero:!0}}]}}}),s=new Chart(a,{type:"line",data:{datasets:[]},options:{responsive:!0,maintainAspectRatio:!1,legend:{display:!1},scales:{xAxes:[{type:"linear",display:!1,gridLines:{display:!1}}],yAxes:[{gridLines:{display:!1}}]}}});function d(t){if(t.length>1){let e=1;const a=1/t.length;for(let o=1;o<t.length;o++)t[o]>t[o-1]?e+=a:t[o]<t[o-1]&&(e-=a);return e}return 1}function l(t){let e;return e=t?{data:{labels:t.map(t=>new Date(t.created).toYMD()),datasets:[{label:"Total Cases",data:t.map(t=>t.cases),backgroundColor:["rgba(255,177,0,0.41)"],borderColor:["rgb(255,249,146)"],borderWidth:1},{label:"Total Deaths",data:t.map(t=>t.deaths),backgroundColor:["rgba(255,24,1,0.4)"],borderColor:["rgb(255,91,82)"],borderWidth:1},{label:"Total Recovered",data:t.map(t=>t.recovered),backgroundColor:["rgba(57,255,0,0.4)"],borderColor:["rgb(141,255,102)"],borderWidth:1}]}}:{data:{labels:[],datasets:[]}}}$("#countries_table").DataTable({ajax:{url:"/countries/today",dataSrc:""},order:[[1,"desc"]],columns:[{data:"country"},{data:"cases"},{data:"todayCases"},{data:"deaths"},{data:"todayDeaths"},{data:"recovered"},{data:"active"},{data:"critical"},{data:"casesPerOneMillion"}]}),$.ajax({url:"/worldwide/today",success:function(t){const e=t.cases-(t.deaths+t.recovered);$("#today-cases").html(t.cases),$("#today-active").html(e),$("#today-deaths").html(t.deaths),$("#today-recovered").html(t.recovered),$("#today-active-percentage").html("("+(e/t.cases*100).toFixed(1)+"%)"),$("#today-deaths-percentage").html("("+(t.deaths/t.cases*100).toFixed(1)+"%)"),$("#today-recovered-percentage").html("("+(t.recovered/t.cases*100).toFixed(1)+"%)")}}),$.ajax({url:"/worldwide",success:function(t){!function(t){if(t.length>1){const e=t[t.length-2].cases,a=[];let o=0;const l=.1;let r=1;for(let e=1;e<t.length-2;e++){const s=d(a);a[e-1]=Math.abs(t[e].cases-t[e+1].cases)/t[e].cases*s*r*100,o+=a[e-1],r+=l}const n=d(a);!function(t){let e=1;const a=1/t.length,o=[];for(let s=1;s<t.length;s++)t[s]>t[s-1]?e+=a:t[s]<t[s-1]&&(e-=a),o.push({x:s,y:Math.round(1e3*e)/1e3});s.data.datasets.push({label:"Outlook",data:o,fill:!1,borderColor:["rgb(82,200,255)"],borderWidth:2}),s.update()}(a);const c=o/a.length;c>0?($("#today-expected-cases").html(Math.round(e+e*c/100)),c>0&&c<5?($("#today-expected-cases").addClass("neutral"),$("#today-expected-cases-percentage").addClass("neutral")):c>=5&&($("#today-expected-cases").addClass("negative"),$("#today-expected-cases-percentage").addClass("negative")),$("#today-expected-cases-percentage").html("(+"+c.toFixed(2)+"%)")):($("#today-expected-cases").html(e),$("#today-expected-cases-percentage").html("(0%)"),$("#today-expected-cases").addClass("positive"),$("#today-expected-cases-percentage").addClass("positive")),n>.9&&n<1.1?($("#today-outlook").html("NEUTRAL"),$("#today-outlook").addClass("neutral"),$("#today-outlook-value").addClass("neutral")):n>=1.1?($("#today-outlook").html("NEGATIVE"),$("#today-outlook").addClass("negative"),$("#today-outlook-value").addClass("negative")):n<=.9&&($("#today-outlook").html("POSITIVE"),$("#today-outlook").addClass("positive"),$("#today-outlook-value").addClass("positive")),$("#today-outlook-value").html("("+(n>=0?"+":"")+n.toFixed(2)+")")}}(t);const e=l(t);o.data.labels.push(...e.data.labels),o.data.datasets.push(...e.data.datasets),o.update()}})});